import{r as e,j as s,B as a,e as t,p as r}from"./mui-BKRBi9c6.js";import{H as i,L as d,r as l}from"./vendor-CXfu1X1j.js";import{C as n}from"./card-DBmDQUNT.js";import{z as c}from"./index-DnSngz2F.js";import{A as o}from"./AuthenticatedLayout-B0v8q34p.js";import{C as m}from"./CustomSelectField-B-S7bTVB.js";import{C as u}from"./CustomTextField-BTuAnPE3.js";import{T as x}from"./Taka-HCVrmtu1.js";import{u as p}from"./app-BLkjJg0m.js";import{A as h}from"./AsynchronousInput-DNmkCEvD.js";import{X as j}from"./x-BWEyoRfZ.js";import{S as g}from"./save-b8lrRLdX.js";import{P as f}from"./package-BZ0coysK.js";import{P as v}from"./plus-avlLwFjE.js";import{M as N}from"./minus-BJgHQvPy.js";import{T as b}from"./trash-2-DJX3qbod.js";import{M as _}from"./map-pin-CREN4_JN.js";import{U as y}from"./user-D2E5EHqK.js";import"./utils-Dp6QJa9S.js";import"./Navbar-Cp-VK2OZ.js";import"./Sidebar-HDh619-e.js";import"./user-check-BkBYIEHF.js";import"./createLucideIcon-DTafSqzE.js";import"./chevron-right-CHPI7KdZ.js";import"./chevron-left-CvYp6kNR.js";function w({order:w,products:C=[],customers:k=[],shippingCosts:S={}}){const{isDarkMode:L}=p(),[T,O]=e.useState(!1),[q,F]=e.useState({status:w?.status||"pending",payment_method:w?.payment_method||"cod",shipping_method:w?.shipping_method||"standard",notes:w?.notes||"",discount_code:"",discount_amount:0}),[A,P]=e.useState(w?.user||null),[E,I]=e.useState(w?.shipping_address||{full_name:"",phone:"",email:"",address_line:"",area:"inside_dhaka"}),[z,D]=e.useState(null),[U,M]=e.useState([]),[$,K]=e.useState(!1),[W,B]=e.useState(w?.items?.map(e=>({id:e.id,product_id:e.product_id,variant_id:e.product_variant_id||e.variant_id,product:e.product,variant:e.variant,quantity:Number(e.quantity||0),unit_price:Number(e.unit_price||0),total_price:Number(e.total_price||0)}))||[]),G=e.useCallback((e,s)=>{const a=s&&(s.image_path||s.image)||e?.images?.find(e=>e.is_primary)?.image_path||e?.images&&e.images[0]?.image_path||e?.image_path||e?.image||"";if(!a)return"/placeholder.svg";const t=String(a).toLowerCase();return t.startsWith("http://")||t.startsWith("https://")?a:`/storage/${a}`},[]),H=W.reduce((e,s)=>e+Number(s.unit_price||0)*Number(s.quantity||0),0),J=(()=>{if("free"===q.shipping_method)return 0;const e=E.area||"inside_dhaka";return S[e]?.[q.shipping_method]||0})(),R=H*q.discount_amount/100,V=H-R+J+0,X=e.useRef(null);e.useEffect(()=>()=>{X.current&&clearTimeout(X.current)},[]);const Y=e.useCallback(e=>{X.current&&clearTimeout(X.current),X.current=setTimeout(()=>{e&&e.length>=2?(K(!0),setTimeout(()=>{const s=C.filter(s=>s.name.toLowerCase().includes(e.toLowerCase())||s.category.toLowerCase().includes(e.toLowerCase())||s.variants?.some(s=>s.title.toLowerCase().includes(e.toLowerCase())||s.sku.toLowerCase().includes(e.toLowerCase()))).flatMap(e=>e.variants?.map(s=>({...s,product:e,productName:e.name,productImage:e.image,productCategory:e.category}))||[]);M(s),K(!1)},300)):(M([]),K(!1))},300)},[C]),Q=(e,s)=>{B(W.map(a=>{if(a.id===e||a.variant_id===e){const e=Number(a.quantity||0)+s;return e<=0?null:{...a,quantity:e,total_price:e*Number(a.unit_price||0)}}return a}).filter(e=>null!==e))};return w?s.jsxs(o,{children:[s.jsx(i,{title:"Edit Order"}),s.jsx("div",{className:"py-4",children:s.jsxs("div",{className:"space-y-6 md:px-[40px] md:py-[18px]",children:[s.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4 mb-8",children:[s.jsxs("div",{children:[s.jsx("h2",{className:"text-2xl leading-9 font-bold text-text-primary",children:"Edit Order"}),s.jsxs("p",{className:"text-sm text-text-secondary mt-2",children:["Order #",w.order_number]})]}),s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(d,{href:route("admin.orders.index"),children:s.jsxs(a,{variant:"outline",className:"gap-2 hover:bg-destructive/10 hover:text-destructive hover:border-destructive/50 transition-all bg-transparent",children:[s.jsx(j,{className:"w-4 h-4"}),"Cancel"]})}),s.jsxs(a,{onClick:()=>{if(0===W.length)return void c.error("Please add at least one product to the order");if(!(E.full_name&&E.phone&&E.email&&E.address_line))return void c.error("Please fill in all shipping address fields");const e={order_id:w.id,user_id:A?.id||null,shipping_address:E,billing_address:E,items:W.filter(e=>e.variant_id).map(e=>({id:e.id,product_id:e.product_id,variant_id:e.variant_id,quantity:e.quantity,unit_price:e.unit_price})),status:q.status,payment_method:q.payment_method,shipping_method:q.shipping_method,notes:q.notes,subtotal:H,shipping_cost:J,discount_total:0,tax_total:0,total:V};O(!0);const s=c.loading("Updating order...");l.post(route("admin.orders.update",{id:w.id}),e,{onSuccess:()=>{O(!1),c.dismiss(s),c.success("Order updated successfully!")},onError:e=>{if(O(!1),c.dismiss(s),e&&"object"==typeof e){const s=Object.values(e).flat();c.error(s.join(", "))}else c.error("Failed to update order. Please try again.")}})},disabled:T,className:"gap-2 px-6 h-11 bg-gradient-to-r from-emerald-500 to-teal-500 hover:from-emerald-600 hover:to-teal-600 text-white shadow-lg shadow-emerald-500/30 transition-all disabled:opacity-50 disabled:shadow-none",children:[s.jsx(g,{className:"w-4 h-4"}),T?"Saving...":"Save Changes"]})]})]}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[s.jsx("div",{className:"lg:col-span-2 space-y-6",children:s.jsxs(n,{className:"p-6 bg-card border-border",children:[s.jsxs("div",{className:"flex flex-col gap-6 mb-6",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"p-2 bg-orange-500/10 rounded-lg",children:s.jsx(f,{className:"w-5 h-5 text-orange-500"})}),s.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"Order Items"})]}),s.jsx("div",{className:"space-y-4",children:s.jsx(h,{options:U,loading:$,onOpen:()=>{},onClose:()=>{M([]),X.current&&(clearTimeout(X.current),X.current=null)},onInputChange:(e,s,a)=>{"input"===a&&Y(s)},onChange:(e,s)=>{D(s)},value:z,getOptionLabel:e=>e?`${e.productName} - ${e.title}`:"",isOptionEqualToValue:(e,s)=>e?.id===s?.id,label:"Search Products",placeholder:"Type at least 2 characters to search...",noOptionsText:0!==U.length||$?"No products found":"Type to search for products...",sx:{width:"100%"},renderOption:(e,a)=>s.jsxs(t,{component:"li",...e,className:"flex items-center gap-3 p-3",children:[s.jsx("img",{src:G(a.product,a),alt:a.productName,className:"w-12 h-12 object-cover rounded-lg flex-shrink-0"}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx(r,{variant:"body2",className:"font-medium text-foreground truncate",children:a.productName}),s.jsxs(r,{variant:"caption",className:"text-muted-foreground",children:[a.title," â€¢ SKU: ",a.sku]})]}),s.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[s.jsx(x,{className:"text-sm"}),s.jsx(r,{variant:"body2",className:"font-medium",children:Number(a.price||0).toFixed(2)})]})]})})}),s.jsx("div",{className:"flex justify-end",children:s.jsx(a,{variant:"contained",onClick:()=>{if(!z)return void c.error("Please select a product variant");const e=W.find(e=>e.variant_id===z.id);B(e?W.map(e=>e.variant_id===z.id?{...e,quantity:Number(e.quantity||0)+1,total_price:(Number(e.quantity||0)+1)*Number(e.unit_price||0)}:e):[...W,{id:null,product_id:z.product.id,variant_id:z.id,product:z.product,variant:z,quantity:1,unit_price:Number(z.price||0),total_price:Number(z.price||0)}]),D(null)},disabled:!z,className:"bg-emerald-500 hover:bg-emerald-600 !text-text-primary",startIcon:s.jsx(v,{className:"w-4 h-4"}),children:"Add to Order"})})]}),s.jsx("div",{className:"space-y-4",children:W.map(e=>s.jsx("div",{className:"bg-muted/30 rounded-lg p-4",children:s.jsxs("div",{className:"flex flex-col 2xl:flex-row 2xl:items-center gap-4",children:[s.jsxs("div",{className:"flex items-center gap-4 flex-1",children:[s.jsx("img",{src:G(e.product,e.variant),alt:e.product?.name,className:"w-16 h-16 object-cover rounded-lg flex-shrink-0"}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("h4",{className:"font-medium text-foreground truncate",children:e.product?.name}),s.jsx("p",{className:"text-sm text-muted-foreground",children:e.variant?.title}),s.jsxs("p",{className:"text-sm text-muted-foreground",children:["SKU: ",e.variant?.sku]})]})]}),s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(a,{variant:"outline",size:"small",onClick:()=>Q(e.id||e.variant_id,-1),className:"w-3 h-8 p-0",children:s.jsx(N,{className:"w-4 h-4"})}),s.jsx("span",{className:"w-12 text-center font-medium",children:e.quantity}),s.jsx(a,{variant:"outline",size:"small",onClick:()=>Q(e.id||e.variant_id,1),className:"w-8 h-8 p-0",children:s.jsx(v,{className:"w-4 h-4"})})]}),s.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center gap-2 lg:gap-6",children:[s.jsxs("div",{className:"text-sm",children:[s.jsx("span",{className:"text-muted-foreground",children:"Unit: "}),s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(x,{className:"text-sm"}),s.jsx("span",{className:"font-medium",children:Number(e.unit_price||0).toFixed(2)})]})]}),s.jsxs("div",{className:"text-sm",children:[s.jsx("span",{className:"text-muted-foreground",children:"Total: "}),s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(x,{className:"text-sm"}),s.jsx("span",{className:"font-medium text-lg",children:Number(e.total_price||0).toFixed(2)})]})]})]}),s.jsx(a,{variant:"outline",size:"small",onClick:()=>{return s=e.id||e.variant_id,void B(W.filter(e=>e.id!==s&&e.variant_id!==s));var s},className:"text-red-500 hover:text-red-700 hover:bg-red-50 flex-shrink-0",children:s.jsx(b,{className:"w-4 h-4"})})]})},e.id||e.variant_id))}),0===W.length&&s.jsxs("div",{className:"text-center py-12",children:[s.jsx(f,{className:"w-16 h-16 text-muted-foreground mx-auto mb-4"}),s.jsx("p",{className:"text-muted-foreground text-lg font-medium",children:"No items in this order"}),s.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Search and select a product variant above to add items"})]})]})}),s.jsxs("div",{className:"space-y-6",children:[s.jsxs(n,{className:"p-6 bg-card border-border shadow-sm",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[s.jsx("div",{className:"p-3 bg-emerald-500/10 rounded-lg",children:s.jsx(x,{className:"text-2xl p-2"})}),s.jsx("h2",{className:"text-xl leading-8 font-bold text-text-primary",children:"Order Summary"})]}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"flex justify-between text-sm",children:[s.jsx("span",{className:"text-muted-foreground",children:"Subtotal"}),s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(x,{className:"text-sm"}),H.toFixed(2)]})]}),q.discount_amount>0&&s.jsxs("div",{className:"flex justify-between text-sm",children:[s.jsxs("span",{className:"text-emerald-500",children:["Discount (",q.discount_amount,"%)"]}),s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(x,{className:"text-sm"}),R.toFixed(2)]})]}),s.jsxs("div",{className:"flex justify-between text-sm",children:[s.jsx("span",{className:"text-muted-foreground",children:"Shipping"}),s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(x,{className:"text-sm"}),J.toFixed(2)]})]}),!1,s.jsxs("div",{className:"pt-4 border-t border-border flex justify-between items-center",children:[s.jsx("span",{className:"font-semibold text-foreground text-lg",children:"Total"}),s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(x,{className:"text-sm"}),V.toFixed(2)]})]})]})]}),s.jsxs(n,{className:"p-6 bg-card border-border",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[s.jsx("div",{className:"p-2 bg-purple-500/10 rounded-lg",children:s.jsx(_,{className:"w-5 h-5 text-purple-500"})}),s.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"Shipping Address"})]}),s.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[s.jsx("div",{children:s.jsx(u,{label:"Full Name",value:E.full_name,onChange:e=>I({...E,full_name:e.target.value})})}),s.jsx("div",{children:s.jsx(u,{label:"Phone",value:E.phone,onChange:e=>I({...E,phone:e.target.value})})}),s.jsx("div",{children:s.jsx(u,{label:"Email",value:E.email,onChange:e=>I({...E,email:e.target.value})})}),s.jsx("div",{children:s.jsx(m,{label:"Area",options:[{label:"Inside Dhaka",value:"inside_dhaka"},{label:"Outside Dhaka",value:"outside_dhaka"}],value:E.area,onChange:e=>I({...E,area:e.target.value})})}),s.jsx("div",{children:s.jsx(u,{label:"Address",value:E.address_line,onChange:e=>I({...E,address_line:e.target.value}),rows:3})})]})]}),s.jsxs(n,{className:"p-6 bg-card border-border",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[s.jsx("div",{className:"p-2 bg-emerald-500/10 rounded-lg",children:s.jsx(y,{className:"w-5 h-5 text-emerald-500"})}),s.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"Customer"})]}),A?s.jsx("div",{className:"p-4 bg-muted/30 rounded-lg",children:s.jsx("div",{className:"flex items-center justify-between",children:s.jsxs("div",{children:[s.jsx("p",{className:"font-medium text-foreground",children:A.name}),s.jsx("p",{className:"text-sm text-muted-foreground",children:A.email}),s.jsx("p",{className:"text-sm text-muted-foreground",children:A.phone})]})})}):s.jsx("div",{className:"space-y-3",children:"Guest"})]})]})]})]})})]}):s.jsx(o,{children:s.jsx("div",{className:"py-4",children:s.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),s.jsx("p",{className:"text-muted-foreground",children:"Loading order details..."})]})})})})}export{w as default};
